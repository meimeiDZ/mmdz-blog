# 分布式

`分布式系统`

> 要理解分布式系统，主要需要明白一下2个方面：
>
> 1. **分布式系统一定是由多个节点组成的系统**。其中，节点指的是计算机服务器，而且这些节点一般不是孤立的，而是互通的。
> 2. 这些连通的节点上部署了我们的节点，并且相互的操作会有**协同**。
>
> 不同的业务模块部署在不同的服务器上或者同一个业务模块分拆多个子业务，部署在不同的服务器上，解决高并发的问题，提供可扩展性以及高可用性，业务中使用分布式的场景主要有分布式存储以及分布式计算。分布式存储中可以将数据分片到多个节点上，不仅可以提高性能（可扩展性），同时也可以使用多个节点对同一份数据进行备份。

`分布式环境的特点`

> 1. **分布性**：服务部署空间具有多样性
> 2. **并发性**：程序运行过程中，并发性操作是很常见的。比如同一个分布式系统中的多个节点，同时访问一个共享资源。数据库、分布式存储
> 3. **无序性**：进程之间的消息通信，会出现顺序不一致问题

`分布式环境下面临的问题`

> 1. **网络通信**：网络本身的不可靠性，因此会涉及到一些网络通信问题
> 2. **网络分区(脑裂)**：当网络发生异常导致分布式系统中部分节点之间的网络延时不断增大，最终导致组成分布式架构的所有节点，只有部分节点能够正常通信
> 3. **三态**：在分布式架构里面多了个状态：超时，所以有三态： 成功、失败、超时
> 4. **分布式事务**：ACID(原子性、一致性、隔离性、持久性)
> 5. **中心化和去中心化**：冷备或者热备

`CAP & BASE理论`

> `CAP`
>
> ![](imgs\cap.png)
>
> **CAP** 也就是 **Consistency（一致性）**、**Availability（可用性）**、**Partition Tolerance（分区容错性）**
>
> - 一致性(Consistency) ： 一致性是指写操作后的读操作可以读取到最新的数据状态，当数据分布在多个节点上，从任意结点读取到的数据都是最新的状态。
> - 可用性(Availability) ： 可用性是指任何事务操作都可以得到响应结果，且不会出现响应超时或响应错误。
> - 分区容错性(Partition tolerance) ： 通常分布式系统的各各结点部署在不同的子网，这就是网络分区，不可避免的会出现由于网络问题而导致结点之间通信失败，此时仍可对外提供服务，这叫分区容忍性。
>
> `CAP的组合方式`
>
> 所以在生产中对分布式事务处理时要根据需求来确定满足 CAP 的哪两个方面。
>
> 1. **AP**
>    放弃一致性，追求分区容忍性和可用性。这是很多分布式系统设计时的选择。
>    例如：上边的商品管理，完全可以实现 AP，前提是只要用户可以接受所查询到的数据在一定时间内不是最新的即可。
>    通常实现 AP 都会保证最终一致性，后面将的 **BASE** 理论就是根据 AP 来扩展的，一些业务场景比如：订单退款，今日退款成功，明日账户到账，只要用户可以接受在一定的时间内到账即可。
> 2. **CP**
>    放弃可用性，追求一致性和分区容错性，zookeeper 其实就是追求的强一致，又比如跨行转账，一次转账请求要等待双方银行系统都完成整个事务才算完成。
> 3. **CA**
>    放弃分区容忍性，即不进行分区，不考虑由于网络不通或结点挂掉的问题，则可以实现一致性和可用性。那么系统将不是一个标准的分布式系统，最常用的关系型数据就满足了 CA。
>
> `CAP总结`
>
> CAP 是一个已经被证实的理论，一个分布式系统最多只能同时满足：一致性（Consistency）、可用性（Availability）和分区容忍性（Partition tolerance）这三项中的两项。它可以作为我们进行架构设计、技术选型的考量标准。对于多数大型互联网应用的场景，结点众多、部署分散，而且现在的集群规模越来越大，所以节点故障、网络故障是常态，而且要保证服务可用性达到 N 个 9（99.99..%），并要达到良好的响应性能来提高用户体验，因此一般都会做出如下选择：保证 P 和 A ，舍弃 C 强一致，保证最终一致性。
>
> ------
>
> `BASE理论`
>
> **BASE** 是 **Basically Available（基本可用）** 、**Soft-state（软状态）** 和 **Eventually Consistent（最终一致性）** 三个短语的缩写。BASE 理论是对 CAP 中一致性 C 和可用性 A 权衡的结果，其来源于对大规模互联网系统分布式实践的总结，是基于 CAP 定理逐步演化而来的，它大大降低了我们对系统的要求。
>
> `BASE 理论的核心思想`
>
> 即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。
>
> *也就是牺牲数据的一致性来满足系统的高可用性，系统中一部分数据不可用或者不一致时，仍需要保持系统整体“主要可用”。*
>
> **BASE 理论本质上是对 CAP 的延伸和补充，更具体地说，是对 CAP 中 AP 方案的一个补充。**
